# DataLoom Studio

DataLoom Studio（旧: ido_editor）は、Next.js 15 と React 19 を基盤にしたブラウザ/デスクトップ両対応の統合ワークスペースです。タブ式エディタ、可視化、データ分析、Git 連携、AI アシストまでを 1 つの UI にまとめ、File System Access API や Electron を利用してローカルファイルを直接扱えます。

## 主な機能

### ワークスペースと UI
- サイドバー（エクスプローラ / Git / GIS / ヘルプ）とメインエリアを切り替え可能なレイアウトに、タブバーやビュー切り替えバナーを組み合わせています。
- テーマ（ライト/ダーク）、フォントサイズ、マルチファイル分析モードなどのエディタ設定をヘッダーから即時変更できます。

### ファイル管理
- File System Access API を用いたローカルフォルダ選択、ツリー表示、右クリックメニューによる新規作成・リネーム・削除、Zip/Tar.gz の圧縮・解凍をサポートしています。
- CSV/TSV/JSON/YAML/Excel など分析対象ファイルの複数選択とタブ生成、Mermaid テンプレートの追加作成に対応します。

### エディタとプレビュー
- CodeMirror 6 ベースのエディタで、拡張子から言語を推定しながら編集・保存・ペースト処理を行い、タブごとにエディタ/プレビュー/分割ビューを切り替えられます。
- Markdown、HTML、Mermaid、Jupyter Notebook、PDF、Excel、各種データ形式のプレビューを組み合わせたタブ別ビューを提供します。
- Excel ファイルは SpreadJS ベースのスプレッドシートビューアで読み込み、複数シートをそのまま編集できます。

### データプレビューと加工
- CSV/TSV/JSON/YAML/Parquet/Excel/GeoJSON などの解析結果をフラット/ネスト表示、テーブル編集、統計列抽出として扱い、データ表示モードを保持します。
- テーブル編集モードは SpreadJS グリッドを採用し、Excel ライクなセル編集・行列追加・ドラッグ操作を備えています。
- Markdown からの Word（.docx）出力や構造化データからの Excel エクスポートなど、タブ内容のエクスポート機能を備えています。

### データ分析ワークフロー
- マルチファイル分析モードでは、複数データの結合（UNION / INTERSECTION / JOIN）や列選択、SQL 実行、チャート・関係グラフ表示を 1 画面で操作できます。
- SQL ノートブック形式でセルを追加・削除しながらクエリ履歴や結果を保存し、`.sqlnb.json` としてエクスポート可能です。

### GIS 分析
- GeoJSON/KML/KMZ/Shapefile などの GIS データを自動検出し、列選択・統計サマリ・マップ描画用データセットに変換します。
- 解析済みデータに対して LLM を利用した洞察リクエストを送り、Markdown レポートや箇条書きのサマリを得られます。

### AI 支援機能
- ヘルプサイドバーで問い合わせスレッドを管理し、権限・マスキング設定を考慮したファイル添付と LLM への質問が可能です。
- OpenAI / Google Gemini の API キー管理と利用プロバイダーの切り替えをグローバル設定で提供し、設定済みかどうかに応じて AI 機能の有効/無効が切り替わります。

### Git 連携
- リポジトリ初期化、状態取得、ステージング/破棄/コミット、ブランチ操作、履歴・差分取得、リモートクローンなどのワークフローをブラウザ上で実行できます。

### インポート / エクスポート
- Mermaid デザインやチャートの結果を含むタブデータのエクスポートに加えて、マルチファイル分析のノートブックを JSON 形式で保存・再読み込みできます。

## セットアップ
1. リポジトリをクローンし依存関係をインストールします。
   ```bash
   npm install
   ```
2. 開発サーバーを起動します。
   ```bash
   npm run dev
   ```
3. Electron 版を同時起動する場合は、別ターミナルで以下を実行します。
   ```bash
   npm run dev:electron
   ```

## ビルド / パッケージ
- Next.js 本番ビルドと起動: `npm run build` / `npm run start`
- Electron パッケージング: `npm run dist`（プラットフォーム別に `dist:mac` / `dist:win` も用意）
- 上記スクリプトは `package.json` で管理されています。

## AI 設定
- OpenAI / Gemini の API キーは `~/.dataloom/settings.json`（または `DATALOOM_CONFIG_DIR` で指定したディレクトリ）に保存され、環境変数で指定したキーが優先されます。
- 設定ダイアログからキーの保存・削除、利用プロバイダーの切り替えを行うと、AI 機能の利用可否や警告がリアルタイムで反映されます。

## 付属ドキュメント
- `docs/` ディレクトリにアーキテクチャや開発手順の補足資料がまとまっています。
- `docs/mygpt-knowledge.md` は MyGPT 向けのナレッジパックです。
- `llms.txt` / `llms-full.txt` は LLM 参照用の技術サマリです。

## SpreadJS 連携について
- `@grapecity/spread-sheets` / `@grapecity/spread-excelio` / `@grapecity/spread-sheets-react` を利用し、Excel ファイルと表形式データの編集 UI を提供します。
- データプレビューの「テーブル編集モード」では SpreadJS グリッドが表示され、セル編集やドラッグフィル、列幅調整などの操作が可能です。
- Excel ファイルは SpreadJS の ExcelIO 経由で読み込み、SpreadJS ワークブックとしてレンダリングします。再読み込みボタンで元ファイルからいつでも読み直せます。

## 既知の制限
- File System Access API 非対応ブラウザではローカルファイルとの直接連携が制限されます。
- 大容量データや未対応フォーマットの解析ではエラーメッセージを返すことがあります（例: GIS 解析で必要ライブラリが無い場合など）。
- Git 差分はテキストファイルを対象としており、バイナリ差分は未対応です。
