# IDO Editor

高機能なデータ分析エディタです。Next.js 15 と React 19 をベースに、Zustand で状態管理しつつ CodeMirror 6 を利用したリッチな編集体験、Markdown/データ/Notebook プレビュー、強力な単一・複数ファイル分析ツールを統合しています。

## 📖 ドキュメント
- **[llms.txt](./llms.txt)** / **[llms-full.txt](./llms-full.txt)** – LLM から参照しやすい技術概要
- **[docs/](./docs/)** – 詳細設計、API、コンポーネント構造、開発ガイド、テスト戦略、シーケンス図

## 🚀 クイックスタート
### 必要環境
- Node.js 18 以上 / npm 8 以上
- File System Access API をサポートする Chromium 系ブラウザ（Chrome、Edge 等）。Firefox や Safari ではローカルファイル連携機能が利用できません。

### セットアップ
```bash
git clone https://github.com/yourusername/ido_editor.git
cd ido_editor
npm install
npm run dev
```
アプリは [http://localhost:3000](http://localhost:3000) に起動します。ビルド／Lint 用スクリプトは `npm run build`、`npm run start`、`npm run lint` を利用してください。

### Electron デスクトップ版
- 開発: `npm run dev:web`（Next.js）と `npm run dev:electron`
- パッケージング: `npm run dist`、Windows 用 `npm run dist:win`、macOS 用 `npm run dist:mac`
- 署名・配布の詳細は [docs/electron.md](./docs/electron.md) を参照

## 🧭 ワークスペース概要
- **ドラッグ&ドロップ対応のマルチタブ**：タブバーは並び替え・複数ファイル編集に対応。
- **表示モード切替**：タブごとに「エディタ」「プレビュー」「分割」を循環切替。Markdown/データ系タブはプレビュー専用 UI を備え、分割モードではスクロール同期が可能です。
- **ヘッダーツール**：フォントサイズ、ライト/ダークテーマ、検索パネル、マルチファイル分析モード、テンポラリファイル作成をワンクリックで操作。
- **ドラッグ&ドロップ読み込み**：ローカルファイルをウィンドウへ直接ドロップすると自動でタブが生成されます。未保存状態では一時タブとして保持され、フォルダ未選択でも新規ファイルを作成できます。

## 📂 ファイルエクスプローラとファイル操作
- File System Access API を利用してローカルフォルダを選択し、ツリー表示・展開を行います。
- コンテキストメニューから新規ファイル/フォルダ作成、リネーム、削除、ルート直下での一括作成が可能です。
- Zip / Tar.gz アーカイブの解凍や、選択アイテムの Zip / Tar.gz 圧縮をブラウザ上で実行できます。
- 複数ファイル分析モードでは CSV/TSV/JSON/YAML/Excel などのデータファイルを選択状態に保持し、後段の分析ビューに渡せます。
- `.exe` や `.dmg` など未対応バイナリは読み込み時にブロックし、誤操作を防ぎます。

## ✍️ 編集・プレビュー機能
### CodeMirror ベースのエディタ
- 自動言語判別・シンタックスハイライト・折りたたみ・矩形選択をサポート。
- `Ctrl/Cmd + S` で File System Access API を通じて保存。ルートフォルダが選択されていれば既存ファイルへ直接書き込みます。
- データファイルタブではツールバーから分析ビューを開いたり、データエクスポートモーダル（CSV/TSV/JSON/YAML/Parquet*¹/Excel）を呼び出せます。

### Markdown と Mermaid
- Markdown プレビューはリアルタイム同期、見出し目次の自動生成、折り畳み、外部リンクの新規タブ開きを備えています。
- Docx ライブラリを利用した Word 出力ボタンを搭載。Markdown 内の ```mermaid``` コードブロックは自動的にダイアグラム化されます。
- Mermaid プレビューは初回アクセス時にライブラリを動的読み込みし、読み込み状況表示と自動リトライで安定化。ズーム、フィット、SVG/PNG での保存、クリップボードコピーをサポートしており、エディタとの分割表示でも利用できます。

### データプレビューと編集
- **対応形式**：CSV、TSV、JSON、YAML、Parquet*¹、Excel（.xlsx/.xls）、Jupyter Notebook (.ipynb)、PDF*²、HTML/Markdown。
- テーブルデータはフラット表示／階層表示を切り替えながらソート・ページネーション・列表示制御・行/列の追加削除が可能。必要に応じてテキスト編集モードへ切り替えられます。
- JSON/YAML はネスト構造を崩さずにブラウズでき、フラット化したテーブルへもワンクリックで変換可能です。
- Excel プレビューはシート一覧、読み込み範囲（開始行・列、終了位置）、ヘッダー有無の指定に対応し、選択シートを即時テーブル化します。
- `.ipynb` プレビューはセル種別ごとのスタイル、Markdown レンダリング、画像/HTML 出力のインライン表示に対応。
- PDF プレビューは PDF.js を利用し、1 ページ目をキャンバス描画します。
- プレビュー画面から Markdown→Word、表データ→Excel などのエクスポートが行えます。

## 📊 データ分析
### 単一ファイル分析
- CSV/TSV/JSON/YAML/Parquet*¹/Excel を対象に、AlasQL による SQL 実行、結果テーブルとチャートの二画面表示、統計サマリーを提供。
- 統計ビューではカラム型推定、欠損値、最大・最小・平均などを自動集計します。
- チャートビューは棒・折れ線・円・散布図・積み上げ棒・回帰分析・ヒストグラム・ガントチャートを用意。X/Y 軸、集計種別、データソース（元データ or クエリ結果）を切り替えられます。
- 関係グラフタブでは JSON ライクなデータを自動でノード/エッジに展開し、Force Graph で可視化します。

### SQL ノートブック（単一ファイル）
- 任意のタブでノートブックモードに切り替えると、複数の SQL セルを作成・順次実行可能。セルごとにテーブル/チャートをトグル表示できます。
- 実行結果・メタ情報を含むスナップショットを `.sqlnb.json` としてエクスポート／インポートでき、履歴を再現したうえで再実行できます。

### 複数ファイル分析
- ヘッダーのマルチファイル分析ボタンをオンにすると専用レイアウトに切り替わり、エクスプローラで選択した複数のデータファイルを対象に統合分析できます。
- Excel ファイルはシート単位・範囲単位で読み込み設定を行い、ファイルごとに保存されます。
- データ統合モードでは UNION / INTERSECTION / JOIN（キー指定可）を選択可能。統合結果は常時テーブル表示され、カラム選択で比較指標を絞り込めます。
- SQL タブでは `FROM combined` や個別ファイル名（拡張子除去）を指定したクエリを実行でき、結果は編集／チャート化が可能です。Notebook モードも備わっており、複数セルの逐次実行や `.sqlnb.json` スナップショットの保存・読み込みに対応します。
- チャートタブは単一ファイル時と同じ構成で、統合データまたはクエリ結果を基にグラフ化します。
- 関係性タブでは統合データから自動生成したネットワーク図を描画します（Cypher 入力欄は将来の外部グラフクエリ統合向けにプレースホルダーとして設置されています）。

## 🔍 検索・置換
- VS Code 風の検索パネルを搭載。大文字小文字、正規表現、単語完全一致、ファイル絞り込み（include/exclude パターン）を指定できます。
- 検索結果はファイルごとに展開表示され、該当行へジャンプ可能。選択したヒットのみ／全件の一括置換にも対応しています。

## 📦 データエクスポート
- Markdown プレビューから Word (.docx) を生成。
- データプレビュー／エディタから CSV、TSV、JSON、YAML、Excel、Parquet*¹（簡易テキスト出力）へ変換しダウンロード可能。文字コードは UTF-8 / Shift_JIS を選択できます。

## ⚠️ 互換性と既知の制限
- File System Access API が利用できない環境ではローカルフォルダ連携、保存、検索は使用できません。必要に応じて最新の Chrome / Edge を利用してください。
- *¹ Parquet サポートはテキストベースまたは簡易変換のみ。バイナリ Parquet の完全解析には追加ライブラリが必要で、読み込み時には警告を表示します。
- *² PDF プレビューは 1 ページ目のレンダリングに限定されています。
- `.exe` / `.dmg` など未対応バイナリや Parquet 以外のバイナリ形式は自動的に除外されます。
- マルチファイル分析のファイル選択は CSV/TSV/JSON/YAML/Excel のみサポートしています。
- Cypher クエリ入力 UI は実装準備段階であり、現行バージョンではクエリ実行は行いません。

## 📚 サンプルデータ
`/test_data/` ディレクトリに Markdown、Mermaid 図、各種 CSV/TSV/JSON/YAML、複数の Excel シナリオ、Jupyter Notebook、PDF/HTML サンプルを同梱しています。分析機能の動作確認やサンプルクエリに活用できます。

---
ドキュメントやアーキテクチャの詳細は [docs/](./docs/) 配下を参照してください。バグ報告や機能提案は issue / PR にてお寄せください。
